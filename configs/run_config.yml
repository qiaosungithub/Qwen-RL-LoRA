training:
    ############### you need to check every time #################
    num_epochs: 480
    batch_size: 256
    learning_rate: 0.0001
    sample_per_ep: 8
    checkpoint_per_epoch: 8

    noise_level: 0.3
    ema: 0.9996 # only for const schedule
    ema_halflife_kimg: 2000 # edm
    ema_schedule: edm # or edm

    label_drop_rate: 0.1
    ####################### end check ############################

    warmup_steps: 25000 # 20 ep for bs1024
    log_per_step: 100

    optimizer: adamw
    adam_b1: 0.9
    adam_b2: 0.95
    weight_decay: 0.0

    # wandb: False # use this to disable wandb
    lr_schedule: const

    # seed: 42
model:
    # name: NF_Small_p2_b8_l8 # 118M, default
    # name: NF_B_p2_b6_l6 # 120M
    # name: NF_M_p2_b10_l9
    # name: NF_L_p2_b12_l9_new # 450M
    name: NF_XL_p2_b15_l9 # 687M
    # name: NF_XL_p2_b16_l8
    # name: NF_XL_p2_b14_l8
    # name: NF_XL_p2_b18_l9
    # name: NF_XL_p2_b16_l10
    # name: NF_XL_p2_b10_l6 # 687M
    # name: NF_XL_p2_b10_l9 # 660M
    # name: NF_XL_p2_b13_l10
    # name: NF_XL_p2_b10_l13
    # name: NF_XL_p2_b12_l9
    # dropout: 0.1
    # prior_norm: 1.05 # default 1
    clip_range: 3.0 # CAUTION: need to set it every time !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    layer_norm: False # use layer norm in MetaBlock
    # cfg_block_num: 8
    # position_embed: rope
    # rms: True
fid:
    on_use: True
    fid_times: 10
    num_samples: 5000 # 50k
    # num_samples: 50000
    guidance: 0.0 # 0 for with label
    guidance_method: xr # ma or x or xr
    inception_device_batch_size: 400
    first_search: [2.5, 2.6, 0.0]
dataset:
    num_workers: 16
    prefetch_factor: 4

wandb_notes: "[XL] B15L9 lr1e-4 REPA6 cos320ep to 480"
save_by_fid: False

search_cfg: True
# search_cfg: False # CAUTION
train_and_eval: True


# load_from: /kmh-nfs-ssd-eu-mount/logs/sqa/sqa_Flow_matching/20250628_092903_3ag7j6_kmh-tpuvm-v3-32-12__b_lr_ep_eval # bs1024 incontext n0.15 clip 1
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_Flow_matching/20250814_020809_sbae26_kmh-tpuvm-v2-128-1__b_lr_ep_eval # bs1024 n0.15 clip3 no label drop rope baseline
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_Flow_matching/20250813_024133_6qy05x_kmh-tpuvm-v2-32-3__b_lr_ep_eval # bs256 + clip 3 + edm ema + donate + lr4e-4
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_NF/20250903_071143_75hky3_kmh-tpuvm-v4-64-spot-yiyang__b_lr_ep_eval # bs256 B12L10 n0.3 lr4e-4
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_NF/20250905_123333_a0ofli_kmh-tpuvm-v4-64-spot-yiyang__b_lr_ep_eval # bs256 B12L10 n0.3 lr2e-4
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_NF/20250906_164753_aduwje_kmh-tpuvm-v4-32-spot-yiyang7__b_lr_ep_eval # bs1024 B n0.3 lr1e-3
# load_from: /kmh-nfs-us-mount/logs/sqa/sqa_NF/20250909_162650_b7m1uq_kmh-tpuvm-v4-64-spot-yiyang2__b_lr_ep_eval # bs256 L B12L9 n0.3 lr2e-4
# load_from: /kmh-nfs-us-mount/logs/sqa/Normalizing-Flow/20250907_105902_l0310t_kmh-tpuvm-v4-32-spot-yiyang3__b_lr_ep_eval # bs256 é¸Ÿ B8L8 L lr4e-4 640ep clip 1.0
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20250927_165304_gf9z9o_kmh-tpuvm-v4-32-spot-yiyang7__b_lr_ep_eval # bs256 B6L6 160ep (FID=8.72)
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20250928_150315_skzaxp_kmh-tpuvm-v4-32-spot-yiyang13__b_lr_ep_eval # bs256 B15L9 320ep (FID 4.77)
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251005_122454_j8nmjx_kmh-tpuvm-v4-64-spot-yiyang3__b_lr_ep_eval # bs256 XL B15L9 480ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251006_160139_itgn6b_kmh-tpuvm-v6e-32-spot-2__b_lr_ep_eval # bs256 L B12L9 lr2e-4 320ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251005_122821_bkwddl_kmh-tpuvm-v4-32-spot-yiyang3__b_lr_ep_eval # bs256 XL B15L9 lr1e-4 160ep (FID 5.51 / 33.02) ema 4000
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251008_065409_svasu5_kmh-tpuvm-v4-32-spot-yiyang__b_lr_ep_eval/checkpoint_800640 # bs256 B6L6 lr5e-4 160ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251008_135655_0fqrp4_kmh-tpuvm-v4-32-spot-yiyang5__b_lr_ep_eval # B6L6 160ep no clip
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251008_204007_ixqf6x_kmh-tpuvm-v4-32-spot-yiyang9__b_lr_ep_eval # [L] B12L9 lr2e-4 480ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251010_031500_05x3r3_kmh-tpuvm-v6e-64-spot__b_lr_ep_eval # bs512 XL B15L9 lr2e-4 320ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251008_144441_5adkpy_kmh-tpuvm-v4-32-spot-yiyang21__b_lr_ep_eval # [XL] B15L9 lr1e-4 ema4000 resume (to 320ep)
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251011_002319_vnvf8b_kmh-tpuvm-v6e-32-spot-3__b_lr_ep_eval # [Xl] B15L9 rope+rms lr1e-4 160ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251011_015321_ixy516_kmh-tpuvm-v6e-32-spot__b_lr_ep_eval # [XL] B15L9 640ep lr2e-4
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251008_204007_ixqf6x_kmh-tpuvm-v4-32-spot-yiyang9__b_lr_ep_eval # [L] B12L9 lr2e-4 480ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251012_234543_mngqyc_kmh-tpuvm-v6e-64-spot__b_lr_ep_eval # [XL] B15L9 lr2e-4 640ep resume
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251015_133624_0sldbb_kmh-tpuvm-v4-32-spot-yiyang9__b_lr_ep_eval # [M] B10L9 lr4e-4 320ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251016_003251_v638ym_kmh-tpuvm-v6e-64-spot__b_lr_ep_eval # [XL] B15L9 bs1024 lr2e-4 640ep resume
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251016_030139_9h54ja_kmh-tpuvm-v6e-32-spot__b_lr_ep_eval # [XL] B15L9 bs256 rope+rms lr1e-4 320ep resume
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251017_045240_s3lb5n_kmh-tpuvm-v6e-32-spot-103_us-central1-b__b_lr_ep_eval # [M] B10L9 lr4e-4 160ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251018_014441_rqbf88_kmh-tpuvm-v6e-32-spot-103_us-central1-b__b_lr_ep_eval # [M] B10L9 lr4e-4 320ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251018_234512_9ikaqi_kmh-tpuvm-v6e-32-spot-106_us-central1-b__b_lr_ep_eval # [M] B10L9 lr4e-4 480ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251017_211152_sfrcvo_kmh-tpuvm-v6e-64-spot_us-east1-d__b_lr_ep_eval # [XL] B15L9 lr1e-4 160ep REPA3
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251019_022639_1yfwx9_kmh-tpuvm-v4-64-spot-yiyang6_us-central2-b__b_lr_ep_eval # [XL] B10L9 lr1e-4 160ep rope+rms
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20250927_223143_3b6klr_kmh-tpuvm-v4-64-spot-yiyang5__b_lr_ep_eval # [XL] B10L9 lr2e-4 160ep
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251022_214001_ansq0s_kmh-tpuvm-v4-64-spot-yiyang2_us-central2-b__b_lr_ep_eval # [XL] B10L9 lr2e-4 320ep (v4)
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251024_132735_4fbk22_kmh-tpuvm-v6e-32-spot-51_us-east5-b__b_lr_ep_eval # [XL] B15L9 sanity v6-32 resume
# load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251026_031023_plw8j5_kmh-tpuvm-v6e-32-spot-106_us-central1-b__b_lr_ep_eval # [XL] B14L8 lr2e-4 resume
load_from: /kmh-nfs-ssd-us-mount/logs/sqa/sqa_NF/20251030_021536_5qhdxu_kmh-tpuvm-v6e-64-spot-101_us-central1-b__b_lr_ep_eval # [XL] B15L9 lr1e-4 REPA6 cos320ep ckpt
# just_evaluate: True # use this to just evaluate the model (without training)